100만 동시접속 실시간 시청자수 시스템 아키텍처 (국내 한정 - Aurora MySQL)
🏗️ 전체 시스템 아키텍처 (한국 단일 리전)
                    🇰🇷 100만 동시 사용자 (국내)
                           |
                    ┌─────────────┐
                    │   Route53   │ 
                    │ (Health Check)│                   "Route53의 Health Check 대상은 ALB입니다."
                    └─────────────┘
                           |
                    ┌─────────────┐
                    │     ALB     │
                    │Application  │                     ALB: 서버 레벨 장애 감지 (WebSocket 서버들 체크)
                    │Load Balancer│
                    └─────────────┘
                           |
                           ▼
💻 WebSocket 서버 클러스터 (AWS Seoul Region)
🔄 Auto Scaling Group (기본 4대 → 최대 20대)
┌─────────────────────────────────────────────────┐
│  WebSocket Server Pool (c5.2xlarge)            │
├─────────────┬─────────────┬─────────────────────┤
│   WS-01     │   WS-02     │   WS-03 ~ WS-20     │
│ (5만 연결)   │ (5만 연결)   │   (필요시 확장)      │
│             │             │                     │
│ CPU: 8 Core │ CPU: 8 Core │   서버 스펙:        │
│ RAM: 16GB   │ RAM: 16GB   │   • 5만 동시연결    │
│ 연결당: 4KB │ 연결당: 4KB │   • 메모리 4KB/연결 │
│ 총: 200MB   │ 총: 200MB   │   • 99.9% 가동률    │
└─────────────┴─────────────┴─────────────────────┘
        │             │             │
        └─────────────┼─────────────┘
                      │
                      ▼
        📍 AZ-2a      📍 AZ-2b      📍 AZ-2c
      (서버 6-7대)   (서버 6-7대)   (서버 6-7대)
📊 Redis 클러스터 (한국 리전 집중)
🚀 Redis Cluster (r5.2xlarge × 6대)
┌─────────────────────────────────────────────────────────┐
│  Master Nodes (3개)          Slave Nodes (3개)         │
├───────────────────────────┬─────────────────────────────┤
│                           │                             │
│  📈 Master-1 (AZ-2a)      │  📈 Slave-1 (AZ-2b)        │
│  • stream_id: 0~33%       │  • 읽기 전용 복제           │
│  • 메모리: 64GB           │  • 장애 시 Master 승격      │
│  • 실시간 시청자 관리     │  • 메모리: 64GB             │
│                           │                             │
│  📈 Master-2 (AZ-2b)      │  📈 Slave-2 (AZ-2c)        │
│  • stream_id: 34~66%      │  • 읽기 전용 복제           │
│  • 메모리: 64GB           │  • 메모리: 64GB             │
│                           │                             │
│  📈 Master-3 (AZ-2c)      │  📈 Slave-3 (AZ-2a)        │
│  • stream_id: 67~100%     │  • 읽기 전용 복제           │
│  • 메모리: 64GB           │  • 메모리: 64GB             │
└───────────────────────────┴─────────────────────────────┘
                      │
                      ▼
🗄️ Aurora MySQL 클러스터 (Multi-AZ 서버리스)
💾 Amazon Aurora MySQL Cluster
┌─────────────────────────────────────────────────────────┐
│                Aurora MySQL Cluster                     │
│  ┌─────────────────────────────────────────────────┐   │
│  │             🔥 Writer Instance                   │   │
│  │           (Primary - AZ-2a)                     │   │
│  │  ┌─────────────────────────────────────────┐   │   │
│  │  │ • db.r5.4xlarge (16 vCPU, 128GB RAM)   │   │   │
│  │  │ • 쓰기 전용 (Write-Only)                │   │   │
│  │  │ • 실시간 데이터 배치 업데이트           │   │   │
│  │  │ • current_viewers 테이블                │   │   │
│  │  │ • viewer_history 테이블                 │   │   │
│  │  │ • Aurora 자동 백업/스냅샷               │   │   │
│  │  └─────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
                      │
                      │ Aurora 복제 (< 10ms)
                      ▼
┌─────────────────────────────────────────────────────────┐
│                  Aurora Reader Instances               │
├─────────────────┬───────────────────┬───────────────────┤
│📖 Reader-1      │📖 Reader-2        │📖 Reader-3        │
│(AZ-2a)          │(AZ-2b)            │(AZ-2c)            │
│                 │                   │                   │
│🎯 랭킹조회       │📈 히스토리 조회    │📊 분석쿼리        │
│• 실시간 시청자순│• 시계열 데이터     │• 통계 리포트      │
│• 인기방송 목록  │• 그래프 데이터     │• 트렌드 분석      │
│• 카테고리별 순위│• 시간대별 비교     │• 대시보드 데이터  │
│• Auto Scaling   │• 방송인별 히스토리 │• 수익 분석        │
│• Connection Pool│• 성장률 계산       │• 예측 모델링      │
│                 │                   │                   │
│db.r5.2xlarge    │db.r5.2xlarge      │db.r5.2xlarge      │
│8 vCPU, 64GB     │8 vCPU, 64GB       │8 vCPU, 64GB       │
└─────────────────┴───────────────────┴───────────────────┘




🔄 Aurora 기반 데이터 흐름 (Data Flow)
👤 국내 사용자 액션           실시간 데이터 처리 흐름 (Aurora 최적화)
     │
     ▼
┌─────────────┐     ⚡ 즉시 처리 (1-2ms)     ┌─────────────┐
│  사용자     │ ─────────────────────────► │   Redis     │
│  입장/퇴장   │    (서울 리전 내)          │   Cluster   │
│  (한국)     │                           │   (서울)    │
└─────────────┘                           └─────────────┘
                                                │
                                                │ 5분마다 배치
                                                ▼
                                          ┌─────────────┐
                                          │   Aurora    │
                                          │   Writer    │
                                          │ (Primary)   │
                                          └─────────────┘
                                                │
                                                │ < 10ms 복제
                                                ▼
                                          ┌─────────────┐
                                          │   Aurora    │
                                          │   Readers   │
                                          │  (3 nodes)  │
                                          └─────────────┘

📱 한국 사용자 화면            조회 데이터 처리 흐름 (Aurora 활용)
     ▲
     │
┌─────────────┐     ⚡ 초고속 응답 (1-2ms)   ┌─────────────┐
│  실시간     │ ◄─────────────────────────  │   Redis     │
│  시청자수   │       (캐시 우선)           │   Cluster   │
└─────────────┘                           └─────────────┘

┌─────────────┐     📊 분석 데이터 (5-15ms) ┌─────────────┐
│  히스토리   │ ◄─────────────────────────  │   Aurora    │
│  통계/랭킹  │    (Reader 로드밸런싱)      │   Readers   │
└─────────────┘                           └─────────────┘
🌐 Aurora 기반 네트워크 및 로드밸런싱
🇰🇷 Aurora Cluster Endpoint 기반 트래픽 분산

                    ┌─────────────────┐
                    │   CloudFront    │
                    │   (서울 엣지)    │
                    │   정적 컨텐츠   │
                    └─────────────────┘
                            │
                    ┌─────────────────┐
                    │  Route 53 DNS   │
                    │  (Health Check) │
                    └─────────────────┘
                            │
                    ┌─────────────────┐
                    │       ALB       │
                    │  (Multi-AZ 분산)│
                    │   Session       │
                    │   Affinity      │
                    └─────────────────┘
                            │
        ┌───────────────────┼───────────────────┐
        │                   │                   │
   📍 AZ-2a              📍 AZ-2b           📍 AZ-2c
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  WS서버들   │    │  WS서버들   │    │  WS서버들   │
│  (6-7대)    │    │  (6-7대)    │    │  (6-7대)    │
│             │    │             │    │             │
│Aurora       │    │Aurora       │    │Aurora       │
│Connection   │    │Connection   │    │Connection   │
│Pool 최적화  │    │Pool 최적화  │    │Pool 최적화  │
└─────────────┘    └─────────────┘    └─────────────┘
        │                   │                   │
        └───────────────────┼───────────────────┘
                            │
                    ┌─────────────────┐
                    │Aurora Cluster   │
                    │Endpoint         │
                    │자동 로드밸런싱  │
                    └─────────────────┘
🛡️ Aurora 기반 고가용성 및 장애 복구
🔧 Aurora Cluster 자동 장애 복구 시스템

┌─────────────────────────────────────────────────────────┐
│              Aurora Cluster Health Check                │
├─────────────────┬───────────────────┬───────────────────┤
│  WebSocket 감지  │   Redis 감지      │  Aurora 감지      │
│                 │                   │                   │
│ ⏰ 30초마다      │ ⏰ 10초마다       │ ⏰ 2초마다        │
│ 📊 AZ별 상태체크│ 📊 클러스터 상태  │ 📊 Writer/Reader  │
│ 🚨 AZ 장애시     │ 🚨 Master 장애시  │ 🚨 Writer 장애시  │
│    트래픽 재분산 │    즉시 페일오버  │    자동 페일오버  │
└─────────────────┴───────────────────┴───────────────────┘
          │                   │                   │
          ▼                   ▼                   ▼
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│  Auto Scaling   │ │ Redis Sentinel  │ │Aurora Auto      │
│  (AZ 분산)      │ │ (AZ 분산 감시)  │ │Failover         │
│                 │ │                 │ │                 │
│ • AZ별 균등분산 │ │ • 30초내 복구   │ │ • 15초내 복구   │
│ • 장애 AZ 차단  │ │ • 무중단 전환   │ │ • 무중단 전환   │
│ • 점진적 복구   │ │ • 데이터 보존   │ │ • 트랜잭션 보존 │
│                 │ │                 │ │ • Reader 자동   │
│                 │ │                 │ │   Writer 승격   │
└─────────────────┘ └─────────────────┘ └─────────────────┘

🔄 Aurora 특화 복구 메커니즘
┌─────────────────────────────────────────────────────────┐
│                  Aurora 자동 복구 기능                   │
├─────────────────┬───────────────────┬───────────────────┤
│   Writer 장애   │   Reader 장애     │   Storage 장애    │
│                 │                   │                   │
│ 🔄 자동 Writer  │ 🔄 Reader 자동    │ 🔄 6-way 복제    │
│    승격 (15초)  │    교체 (30초)    │    자동 복구      │
│                 │                   │                   │
│ • Reader 중 하나│ • 새 Reader 인스턴스│ • 10GB 단위     │
│   를 Writer로   │   자동 생성       │   독립 복구      │
│   자동 승격     │ • 로드밸런서 자동 │ • 데이터 손실   │
│ • 기존 Writer   │   업데이트        │   없음 (ACID)    │
│   트래픽 차단   │ • 복제 지연 최소화│ • SSD 기반       │
│ • 무중단 전환   │ • Connection Pool │   빠른 복구      │
│                 │   재설정          │                   │
└─────────────────┴───────────────────┴───────────────────┘
📈 Aurora 성능 최적화
🚀 Aurora MySQL 성능 튜닝

┌─────────────────────────────────────────────────────────┐
│                Aurora 엔진 최적화                        │
├─────────────────┬───────────────────┬───────────────────┤
│  Writer 최적화   │  Reader 최적화    │  Connection 최적화│
│                 │                   │                   │
│ 🎯 배치 처리    │ 🎯 읽기 분산      │ 🎯 Connection Pool│
│ • 5분마다       │ • 3개 Reader      │ • HikariCP 사용   │
│   대용량 INSERT │   로드밸런싱      │ • 최대 100개 연결 │
│ • 트랜잭션      │ • 쿼리별 라우팅   │ • Idle Timeout:   │
│   배치 그룹화   │ • 캐시 활용       │   10분            │
│ • Auto Commit   │                   │ • Validation:     │
│   비활성화      │ 📊 쿼리 분산:     │   3초             │
│                 │ • 랭킹 → Reader-1 │                   │
│ 📊 성능 지표:   │ • 히스토리→Reader-2│ 📊 모니터링:     │
│ • 목표 TPS:     │ • 분석 → Reader-3 │ • Active 연결 수  │
│   5,000 writes  │                   │ • Wait 시간       │
│ • 배치 크기:    │ 📊 성능 지표:     │ • Connection 생성 │
│   1,000 rows    │ • 평균 응답: 10ms │   시간            │
│                 │ • 캐시 적중률:90% │                   │
└─────────────────┴───────────────────┴───────────────────┘

┌─────────────────────────────────────────────────────────┐
│                  Aurora 스토리지 최적화                  │
├─────────────────┬───────────────────┬───────────────────┤
│   파티셔닝      │   인덱싱 전략     │   백업 전략       │
│                 │                   │                   │
│ 📅 시간 기반    │ 🔍 Aurora 특화    │ 🔄 자동 백업     │
│ • viewer_history│ • 클러스터링 인덱스│ • 연속 백업      │
│   월별 파티션   │ • 커버링 인덱스   │ • 포인트 인 타임  │
│ • user_sessions │ • 함수 기반 인덱스│   복구 (35일)     │
│   일별 파티션   │                   │ • 자동 스냅샷     │
│                 │ 📊 인덱스 관리:   │   (매일)          │
│ 📊 파티션 관리: │ • 사용률 모니터링 │                   │
│ • 자동 생성     │ • 중복 인덱스 제거│ 📊 백업 지표:     │
│ • 자동 삭제     │ • 통계 업데이트   │ • RPO: 1분        │
│ • 병렬 처리     │   자동화          │ • RTO: 15분       │
│                 │                   │ • 압축률: 70%     │
└─────────────────┴───────────────────┴───────────────────┘
💰 Aurora 기반 비용 최적화
💸 Aurora MySQL 월 비용 계산 (서울 리전)

┌─────────────────────────────────────────────────────────┐
│                     Aurora 비용                         │
├─────────────────┬───────────────────┬───────────────────┤
│  Writer Instance│   Reader Instances│   Storage 비용    │
│                 │                   │                   │
│ db.r5.4xlarge   │ db.r5.2xlarge × 3 │ Aurora Storage    │
│ $732/월         │ $366 × 3 =        │                   │
│                 │ $1,098/월         │ 📊 사용량:        │
│ 📊 사양:        │                   │ • 기본: 200GB     │
│ • 16 vCPU       │ 📊 각 Reader 사양:│ • 성장: 50GB/월   │
│ • 128GB RAM     │ • 8 vCPU          │ • 백업: 350GB     │
│ • 25Gbps Network│ • 64GB RAM        │                   │
│                 │ • 10Gbps Network  │ 💰 비용:          │
│ 🎯 용도:        │                   │ • $0.10/GB/월     │
│ • 배치 업데이트 │ 🎯 각 용도:       │ • Storage: $20/월 │
│ • 실시간 삽입   │ • 랭킹 조회       │ • 백업: $7/월     │
│ • 스키마 변경   │ • 히스토리 조회   │ • I/O: $15/월     │
│                 │ • 분석 쿼리       │                   │
└─────────────────┴───────────────────┴───────────────────┘

┌─────────────────────────────────────────────────────────┐
│                  전체 시스템 비용                        │
├─────────────────┬───────────────────┬───────────────────┤
│  WebSocket 서버  │   Redis 클러스터  │   Aurora MySQL   │
│                 │                   │                   │
│ c5.2xlarge × 4  │ r5.2xlarge × 6    │ Writer + Reader   │
│ $245 × 4 =      │ $365 × 6 =        │ $732 + $1,098 =   │
│ $980/월         │ $2,190/월         │ $1,830/월         │
│                 │                   │                   │
│ Auto Scaling:   │ ElastiCache:      │ Storage + Backup: │
│ 최대 20대시     │ 클러스터 모드     │ $42/월            │
│ $4,900/월       │ 고가용성 보장     │                   │
│                 │                   │ 총 Aurora 비용:   │
│                 │                   │ $1,872/월         │
└─────────────────┴───────────────────┴───────────────────┘

📊 총 예상 비용 분석:
- 기본 운영 (100만 동시접속): 월 $5,042 (약 665만원)
- 피크 시간 (Auto Scaling): 월 $8,062 (약 1,060만원)  
- 연결당 비용: $0.005/월 (Aurora 포함, 여전히 경쟁력)
- Aurora 이점: 관리 오버헤드 감소, 자동 백업, 고가용성
🔄 Aurora 기반 확장 계획
📈 Aurora Serverless 고려 확장 로드맵

1단계: 국내 100만 (현재)
┌─────────────────┐
│   서울 리전     │
│   • Aurora      │
│     Provisioned │
│   • Writer 1개  │
│   • Reader 3개  │
│   • $1,872/월   │
└─────────────────┘

2단계: 국내 200만 (6개월 후)
┌─────────────────┐
│   서울 리전     │
│   • Aurora      │
│     Provisioned │
│   • Writer 2개  │
│   • Reader 6개  │
│   • $3,744/월   │
└─────────────────┘

3단계: Aurora Serverless 전환 (12개월 후)
┌─────────────────┐
│   서울 리전     │
│   • Aurora      │
│     Serverless  │
│   • Auto Scale  │
│   • Pay per use │
│   • $2,500/월   │
│     (예상)      │
└─────────────────┘

4단계: 글로벌 확장 (18개월 후)
┌──────┬──────┬──────┬──────┐
│ 서울 │ 도쿄 │ 싱가폴│ 뭄바이│
│Aurora│Aurora│Aurora│Aurora│
│Cluster│Cluster│Cluster│Cluster│
│200만 │100만 │100만 │100만 │
└──────┴──────┴──────┴──────┘
🎯 Aurora 특화 DBA 어필 포인트
✅ Aurora 전문성
- Aurora 클러스터 설계 및 운영 경험
- Writer/Reader 분산 전략 수립
- Aurora 백로그 복제 최적화 (< 10ms)
- Connection Pool 최적화 (HikariCP)

✅ Aurora 고가용성
- 15초 내 자동 페일오버 설계
- 6-way 스토리지 복제 활용
- Multi-AZ Reader 분산 배치
- 무중단 운영 보장 (99.99% SLA)

✅ Aurora 성능 최적화  
- 클러스터링 인덱스 활용
- 배치 쓰기 최적화 (5,000 TPS)
- 읽기 전용 쿼리 분산 라우팅
- Aurora 병렬 쿼리 활용

✅ Aurora 비용 최적화
- Reserved Instance 활용
- Aurora Serverless 도입 계획
- 스토리지 자동 확장 설정
- 백업 정책 최적화 (35일 → 7일)